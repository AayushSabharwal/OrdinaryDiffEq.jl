struct ESDIRK4Tableau{T,T2}
    γ::T
    a31::T
    a32::T
    a41::T
    a42::T
    a43::T
    bhat1::T
    bhat2::T
    bhat3::T
    bhat4::T
    c3::T2
    α1::T
    α2::T
    α41::T
    α43::T
end

#=
Derivative of Hermite Polynomial
k[1] + Θ*(-4*dt*k[1] - 2*dt*k[2] - 6*y₀ + Θ*(3*dt*k[1] + 3*dt*k[2] + 6*y₀ - 6*y₁) + 6*y₁)/dt

Extrapolation for ESDIRK interior step 3
dt = c2 since interval is [c1,c2] and c1 = 0
θ =  c3/c2 the extrapolation point
z = dt*k

z₁ + Θ*(-4dt*z₁ - 2dt*z₂ - 6y₀ + Θ*(3dt*z₁ + 3z₂ + 6y₀ - 6y₁ ) + 6y₁)/dt

Test Expression on TRBDF2:
c2 = 2 - sqrt(2)
c3 = 1
θ = c3/c2; dt = c2

Coefficient on z₁:
(1 + (-4θ + 3θ^2))*z₁
1 + (-4θ + 3θ^2) - (1.5 + sqrt(2)) # 1.5 + sqrt(2) given by Shampine

Coefficient on z₂:
(-2θ + 3θ^2)*z₂
(-2θ + 3θ^2) - (2.5 + 2sqrt(2)) # 2.5 + 2sqrt(2) given by Shampine

Coefficient on y₁-y₀:
θ*(θ*6(y₀-y₁)+6(y₁-y₀))/dt
θ*(-6θ(y₁-y₀)+6(y₁-y₀))/dt
(y₁-y₀)6θ*(1-θ)/dt

(6θ*(1-θ)/dt)*(y₁-y₀)

6θ*(1-θ)/dt - (- (6 + 4.5sqrt(2)))  # - (6 + 4.5sqrt(2)) given by Shampine

# Write only in terms of z primatives
y₀ = uprev
y₁ = uprev + γ*z₁ + γ*z₂
y₁-y₀ = γ*z₁ + γ*z₂

# Full Expression
((1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/dt)*γ)*z₁ + ((-2θ + 3θ^2) + (6θ*(1-θ)/dt)*γ)*z₂
=#

#=
# Kvaerno3
# Predict z4 from yhat

yhat = uprev + a31*z1 + a32*z2 + γ*z3
z₄ = yhat - uprev = a31*z1 + a32*z2 + γ*z3

# Note Hermite is too small of an interval for this one!!!
=#

function Kvaerno3Tableau(T,T2)
  γ   = T(0.4358665215)
  a31 = T(0.490563388419108)
  a32 = T(0.073570090080892)
  a41 = T(0.308809969973036)
  a42 = T(1.490563388254106)
  a43 = -T(1.235239879727145)
  bhat1 = T(0.490563388419108)
  bhat2 = T(0.073570090080892)
  bhat3 = T(0.4358665215)
  bhat4 = T(0.0)
  c3 = T2(1)
  c2 = 2γ
  θ = c3/c2
  α1 = ((1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/c2)*γ)
  α2 = ((-2θ + 3θ^2) + (6θ*(1-θ)/c2)*γ)
  α41 = T(0.0)
  α43 = T(0.0)
  ESDIRK4Tableau(γ,a31,a32,a41,a42,a43,bhat1,bhat2,bhat3,bhat4,c3,α1,α2,α41,α43)
end

#=
# KenCarp3
# Predict z4 from Hermite z2 and z1
# Not z3 because c3 < c2 !

θ = c3/c2
dt = c2
((1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/c2)*γ)
((-2θ + 3θ^2) + (6θ*(1-θ)/c2)*γ)
θ = c4/c2
((1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/c2)*γ)
((-2θ + 3θ^2) + (6θ*(1-θ)/c2)*γ)
=#

function KenCarp3Tableau(T,T2)
  γ  = T(1767732205903//4055673282236)
  a31 = T(2746238789719//10658868560708)
  a32 = -T(640167445237//6845629431997)
  a41 = T(1471266399579//7840856788654)
  a42 = -T(4482444167858//7529755066697)
  a43 = T(11266239266428//11593286722821)
  bhat1 = T(2756255671327//12835298489170)
  bhat2 = -T(10771552573575//22201958757719)
  bhat3 = T(9247589265047//10645013368117)
  bhat4 = T(2193209047091//5459859503100)
  c3 = T2(3//5)
  c2 = 2γ
  θ = c3/c2
  α1 = ((1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/c2)*γ)
  α2 = ((-2θ + 3θ^2) + (6θ*(1-θ)/c2)*γ)
  θ = 1/c2
  α41 = ((1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/c2)*γ)
  α43 = ((-2θ + 3θ^2) + (6θ*(1-θ)/c2)*γ)
  ESDIRK4Tableau(γ,a31,a32,a41,a42,a43,bhat1,bhat2,bhat3,bhat4,c3,α1,α2,α41,α43)
end

struct Cash4Tableau{T,T2}
  γ::T
  a21::T
  a31::T
  a32::T
  a41::T
  a42::T
  a43::T
  a51::T
  a52::T
  a53::T
  a54::T
  b1hat1::T
  b2hat1::T
  b3hat1::T
  b4hat1::T
  b1hat2::T
  b2hat2::T
  b3hat2::T
  b4hat2::T
  c2::T2
  c3::T2
  c4::T2
end

#=
Extrapolation for Cash interior step 3
dt = c1-c2 since interval is [c2,c1] and c1 = 0
c2 < c1, so z₂ is the left
θ =  (c3-c1)/dt the extrapolation point
z = dt*k

z₂ + Θ*(-4dt*z₂ - 2dt*z₁ - 6y₀ + Θ*(3dt*z₂ + 3z₁ + 6y₀ - 6y₁ ) + 6y₁)/dt

Coefficient on z₁:
(-2θ + 3θ^2)

Coefficient on z₂:
(1 + (-4θ + 3θ^2))

Coefficient on y₁-y₀:
(6θ*(1-θ)/dt)

# Write only in terms of z primatives
y₁ = uprev + a21*z₁ + γ*z₂
y₀ = uprev + γ*z₁
y₁-y₀ = (a21-γ)*z₁ + γ*z₂

θ = 1.1
Full z₁ coefficient: (-2θ + 3θ^2) + (6θ*(1-θ)/dt)*(a21-γ)
Full z₂ coefficient: (1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/dt)*γ

f(θ)= (-2θ + 3θ^2) + (6θ*(1-θ)/dt)*(a21-γ)
g(θ) = (1 + (-4θ + 3θ^2)) + (6θ*(1-θ)/dt)*γ
t = linspace(0,1.5,100)
y = f.(t)
z = g.(t)
plot(t,y)
plot!(t,z)

The extrapolation is really bad that far
Hairer's extrapolation is no better.
Using constant extrapolations
=#

function Cash4Tableau(T,T2)
  γ = T(0.435866521508)
  a21 = T(-1.13586652150)
  a31 = T(1.08543330679)
  a32 = -T(0.721299828287)
  a41 = T(0.416349501547)
  a42 = T(0.190984004184)
  a43 = T(-0.118643265417)
  a51 = T(0.896869652944)
  a52 = T(0.0182725272734)
  a53 = -T(0.0845900310706)
  a54 = -T(0.266418670647)
  b1hat1 = T(1.05646216107052)
  b2hat1 = -T(0.0564621610705236)
  b3hat1 = T(0)
  b4hat1 = T(0)
  b1hat2 = T(0.776691932910)
  b2hat2 = T(0.0297472791484)
  b3hat2 = -T(0.0267440239074)
  b4hat2 = T(0.220304811849)
  c2 = -T2(0.7)
  c3 = T2(0.8)
  c4 = T2(0.924556761814)
  Cash4Tableau(γ,a21,a31,a32,a41,a42,a43,a51,a52,a53,a54,
               b1hat1,b2hat1,b3hat1,b4hat1,b1hat2,b2hat2,b3hat2,b4hat2,c2,c3,c4)
end

struct Hairer4Tableau{T,T2}
  γ::T
  a21::T
  a31::T
  a32::T
  a41::T
  a42::T
  a43::T
  a51::T
  a52::T
  a53::T
  a54::T
  bhat1::T
  bhat2::T
  bhat3::T
  bhat4::T
  c2::T2
  c3::T2
  c4::T2
  r11::T
  r12::T
  r13::T
  r14::T
  r21::T
  r22::T
  r23::T
  r24::T
  r31::T
  r32::T
  r33::T
  r34::T
  r41::T
  r42::T
  r43::T
  r44::T
  r51::T
  r52::T
  r53::T
  r54::T
  α21::T
  α31::T
  α32::T
  α41::T
  α43::T
end

function Hairer4Tableau(T,T2)
  γ = T(1//4)
  c2 = T(3//4)
  c3 = T(11//20)
  c4 = T(1//2)

  #=
  α21 = T(2)
  α31 = T(42//25)
  α32 = -T(4//25)
  α41 = T(89//68)
  α42 = -T(25//136)
  α43 = T(15//136)
  α51 = -T(37//12)
  α52 = -T(103//24)
  α53 = T(275//8)
  α54 = -T(85//3)

  alpha = -inv(A)*γ

  α = [-1 0 0 0 0
       α21 -1 0 0 0
       α31 α32 -1 0 0
       α41 α42 α43 -1 0
       α51 α52 α53 α54 -1]
  A α = -γ
  A = -γ*inv(α)

  Now zⱼ = fⱼ + ∑α_ⱼᵢ zᵢ
  =#

  a11 = 1//4
  a21 = 1//2
  a22 = 1//4
  a31 = 17//50
  a32 = -1//25
  a33 = 1//4
  a41 = 371//1360
  a42 = -137//2720
  a43 = 15//544
  a44 = 1//4
  a51 = 25//24
  a52 = -49//48
  a53 = 125//16
  a54 = -85//12

  #=
  e1 = -T(23//6)
  e2 = -T(17//12)
  e3 = T(125//4)
  e4 = -T(85//3)
  E = [e1 e2 e3 e4 0]

  bhat = [59//48,-17//96,225//32,-85//12,0]

  α = [-1 0 0 0 0
       α21 -1 0 0 0
       α31 α32 -1 0 0
       α41 α42 α43 -1 0
       e1 e2 e3 e4 -1]

  A = [γ 0 0 0 0
       a21 γ 0 0 0
       a31 a32 γ 0 0
       a41 a42 a43 γ 0
       a51 a52 a53 a54 γ]

  E = bhat'*inv(A)
  bhat = E*A
  =#

  bhat1 = 59//48
  bhat2 = -17//96
  bhat3 = 225//32
  bhat4 = -85//12

  #=
  d11 = T(61//27)
  d12 = T(-185//54)
  d13 = T(2525//18)
  d14 = T(-3740//27)
  d15 = T(-44//9)
  d21 = T(2315//81)
  d22 = T(1049//162)
  d23 = T(-27725//54)
  d24 = T(40460//81)
  d25 = T(557//27)
  d31 = T(-6178//81)
  d32 = T(-1607//81)
  d33 = T(20075//27)
  d34 = T(-56440//81)
  d35 = T(-718//27)
  d41 = T(3680//81)
  d42 = T(1360//81)
  d43 = T(-10000//27)
  d44 = T(27200//81)
  d45 = T(320//27)

  D = [d11 d12 d13 d14 d15
       d21 d22 d23 d24 d25
       d31 d32 d33 d34 d35
       d41 d42 d43 d44 d45]
  R = (D*A)'
  =#

  r11 = 11//3
  r12 = -463//72
  r13 = 217//36
  r14 = -20//9
  r21 = 11//2
  r22 = -385//16
  r23 = 661//24
  r24 = -10//1
  r31 = -125//18
  r32 = 20125//432
  r33 = -8875//216
  r34 = 250//27
  r41 = 0
  r42 = -85//4
  r43 = 85//6
  r44 = 0//1
  r51 = -11//9
  r52 = 557//108
  r53 = -359//54
  r54 = 80//27

  # c2/γ
  α21 = T(3)
  #=
  # Prediction alphas from Hairer
  # Predict z3 from z1 and z2
  A = [c1 c2
  γ*c1 a21*c1+γ*c2]
  b = [c3,a31*c1+a32*c2+γ*c3]
  A\b
  =#
  α31 = T(88//100)
  α32 = T(44//100)
  #=
  # Predict z4 from z1 and z3
  A = [c1   c3
       γ*c1 a31*c1+a32*c2+γ*c3]
  b = [c4,a41*c1+a42*c2+a43*c3+γ*c4]
  A\b
  =#
  α41 = T(3//17)
  α43 = T(155//187)


  Hairer4Tableau(γ,a21,a31,a32,a41,a42,a43,a51,a52,a53,a54,
                 bhat1,bhat2,bhat3,bhat4,c2:,c3:,c4:,r11,r12,r13,r14,
                 r21,r22,r23,r24,r31,r32,r33,r34,r41,r42,r43,r44,r51,
                 r52,r53,r54,α21,α31,α32,α41,α43)
end



function Hairer42Tableau(T,T2)
  γ  = T(4//15)
  c2 = T2(23//30)
  c3 = T2(17//30)
  c4 = T2(2881//28965)+γ
  #=
  α21 = T(15//8)
  α31 = T(1577061//922880)
  α32 = -T(23427//115360)
  α41 = T(647163682356923881//2414496535205978880)
  α42 = -T(593512117011179//3245291041943520)
  α43 = T(559907973726451//1886325418129671)
  α51 = T(724545451//796538880)
  α52 = -T(830832077//267298560)
  α53 = T(30957577//2509272)
  α54 = -T(69863904375173//6212571137048)

  α = [-1 0 0 0 0
       α21 -1 0 0 0
       α31 α32 -1 0 0
       α41 α42 α43 -1 0
       α51 α52 α53 α54 -1]
  A = -γ*inv(α)
  =#
  a21 = T(1//2)
  a31 = T(51069//144200)
  a32 = T(-7809//144200)
  a41 = T(12047244770625658//141474406359725325)
  a42 = T(-3057890203562191//47158135453241775)
  a43 = T(2239631894905804//28294881271945065)
  a51 = T(181513//86430)
  a52 = T(-89074//116015)
  a53 = T(83636//34851)
  a54 = T(-69863904375173//23297141763930)

  #=

  A = [γ 0 0 0 0
       a21 γ 0 0 0
       a31 a32 γ 0 0
       a41 a42 a43 γ 0
       a51 a52 a53 a54 γ]

  A = convert(Array{Rational{BigInt}},A)

  e1 = T(7752107607//11393456128)
  e2 = -T(17881415427//11470078208)
  e3 = T(2433277665//179459416)
  e4 = -T(96203066666797//6212571137048)
  E = [e1 e2 e3 e4 0]

  bhat = E*A
  =#

  bhat1 = 33665407//11668050
  bhat2 = -2284766//15662025
  bhat3 = 11244716//4704885
  bhat4 = -96203066666797//23297141763930

  #=
  d11 = T(24.74416644927758)
  d12 = -T(4.325375951824688)
  d13 = T(41.39683763286316)
  d14 = T(-61.04144619901784)
  d15 = T(-3.391332232917013)
  d21 = T(-51.98245719616925)
  d22 = T(10.52501981094525)
  d23 = T(-154.2067922191855)
  d24 = T(214.3082125319825)
  d25 = T(14.71166018088679)
  d31 = T(33.14347947522142)
  d32 = T(-19.72986789558523)
  d33 = T(230.4878502285804)
  d34 = T(-287.6629744338197)
  d35 = T(-18.99932366302254)
  d41 = T(-5.905188728329743)
  d42 = T(13.53022403646467)
  d43 = T(-117.6778956422581)
  d44 = T(134.3962081008550)
  d45 = T(8.678995715052762)

  =#

  r11 = 6.776439256624082
  r12 = -14.066831911883533
  r13 = 16.204808856162565
  r14 = -6.8143005003361985
  r21 = 3.166691382949011
  r22 = -14.034196189427504
  r23 = 15.497198116229603
  r24 = -5.3974733381957005
  r31 = -1.9310469085972866
  r32 = 11.146663701107887
  r33 = -6.9009212321038405
  r34 = 0.085120800673252
  r41 = -6.107728468864632
  r42 = 13.031255018633459
  r43 = -19.734599430149146
  r44 = 9.812254180511282
  r51 = -0.9043552621112034
  r52 = 3.9231093815698106
  r53 = -5.066486310139344
  r54 = 2.3143988573474035

  η = T(23//8)
  α31 = T(0.9838473040915402)
  α32 = T(0.3969226768377252)
  α41 = T(0.6563374010466914)
  α42 = T(0.3372498196189311)

  Hairer4Tableau(γ,a21,a31,a32,a41,a42,a43,a51,a52,a53,a54,
                 bhat1,bhat2,bhat3,bhat4,c2:,c3:,c4:,r11,r12,r13,r14,
                 r21,r22,r23,r24,r31,r32,r33,r34,r41,r42,r43,r44,r51,
                 r52,r53,r54,α21,α31,α32,α41,α43)
end
